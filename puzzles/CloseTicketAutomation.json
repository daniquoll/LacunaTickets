{"id":"Z123RM","name":"Закрыть обращение","options":[],"trigger":"INTERACTION_BUTTON","components":[{"type":"ACTION","action":{"type":"EXECUTE_CODE","execute_code":{"code":"if (interaction.customId === 'close-ticket') {\r\n  const tickets = await getValue(`tickets.${channel.parentId}`) ?? []\r\n  const ticket = tickets.find(v => v.status === 'OPENED' && v.id === channel.id)\r\n\r\n  if (!ticket) {\r\n    await reply({\r\n      content: `${member.user.username}, обращение не найдено`,\r\n      ephemeral: true\r\n    })\r\n\r\n    return\r\n  }\r\n\r\n  if (ticket.user_id !== member.user.id) {\r\n    await reply({\r\n      content: `${member.user.username}, вы можете закрыть только свои обращения`,\r\n      ephemeral: true\r\n    })\r\n\r\n    return\r\n  }\r\n\r\n  const ticketIndex = tickets.findIndex(v => v.id === channel.id)\r\n  tickets[ticketIndex].status = 'CLOSED'\r\n\r\n  await deleteChannel(ticket.id)\r\n  await deferUpdate()\r\n}"}}}]}